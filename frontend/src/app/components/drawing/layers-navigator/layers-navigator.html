<div class="container">
  <div class="layer-buttons">
    <button
      class="button layer-btn"
      (click)="addNewLayer()"
      aria-label="Add layer"
      title="Add layer"
    >
      +
    </button>

    <button
      class="button layer-btn"
      (click)="removeSelected()"
      aria-label="Delete layer"
      title="Delete layer"
    >
      <fa-icon [icon]="faTrash" size="lg"></fa-icon>
    </button>
  </div>

  <div class="opacity-wrap" *ngIf="activeLayer$ | async as active">
    <input
      type="range"
      min="0"
      max="100"
      [value]="active.opacity * 100"
      aria-label="Layer opacity"
      (input)="changeOpacity(active.id, $event)"
    />

    <div class="opacity-label">Opacity: {{ active.opacity * 100 | number : '1.0-0' }}%</div>
  </div>

  <div class="layers" cdkDropList [cdkDropListData]="layers" (cdkDropListDropped)="onDrop($event)">
    <div
      class="layer"
      *ngFor="let l of layers; trackBy: trackById"
      cdkDrag
      cdkDragLockAxis="y"
      (click)="selectLayer(l.id)"
      [class.active]="l.id === (activeLayer$ | async)?.id"
    >
      <span class="drag-handle" cdkDragHandle aria-label="Drag layer">⋮⋮</span>

      <div class="thumb" [style.opacity]="l.opacity">
        <img [src]="l.canvasData" class="thumb-img" />
      </div>

      <span class="name">{{ l.name }}</span>

      <button
        type="button"
        class="icon-btn"
        (click)="onToggleVisible(l.id, l.visible); $event.stopPropagation()"
        [attr.aria-pressed]="l.visible"
        [title]="l.visible ? 'Hide layer' : 'Show layer'"
      >
        <fa-icon [icon]="l.visible ? faEye : faEyeSlash"></fa-icon>
      </button>
    </div>
  </div>
</div>
