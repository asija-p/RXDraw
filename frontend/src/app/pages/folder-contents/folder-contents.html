<h2 class="title">
  {{ (openedFolder$ | async)?.name || '...' }}
</h2>

<div class="search-row">
  <mat-form-field class="full">
    <mat-label>Search by name</mat-label>
    <input
      matInput
      type="text"
      placeholder="Start typing a name…"
      [(ngModel)]="searchText"
      (ngModelChange)="onSearchChange($event)"
    />
    <mat-icon matSuffix fontIcon="search"></mat-icon>
  </mat-form-field>
</div>

<div class="grid-wrap" *ngIf="filteredDrawings$ | async as drawings">
  <div class="grid">
    <a
      class="card"
      *ngFor="let d of drawings; trackBy: trackById"
      [routerLink]="['/drawing-editor', d.id]"
      title="Open {{ d.name }}"
    >
      <div class="thumb">
        <img
          [src]="d.thumbnailUrl || 'assets/placeholder-thumb.png'"
          [alt]="d.name"
          loading="lazy"
          decoding="async"
        />
      </div>
      <div class="bottom">
        <div class="meta" *ngIf="editingId !== d.id; else editBlock">
          <div class="name">{{ d.name }}</div>
          <div class="sub">{{ d.width }}×{{ d.height }} • {{ d.updatedAt }}</div>
        </div>

        <ng-template #editBlock>
          <input
            class="name-input"
            [ngModel]="editValue"
            (ngModelChange)="editValue = $event"
            (keyup.enter)="commitEdit(d)"
            (keyup.escape)="cancelEdit()"
            (blur)="commitEdit(d)"
            placeholder="New name"
          />
        </ng-template>

        <div class="card-actions">
          <button
            mat-icon-button
            class="icon-btn"
            aria-label="Rename drawing"
            title="Rename drawing"
            (click)="$event.preventDefault(); $event.stopPropagation(); startEdit(d)"
          >
            <mat-icon fontIcon="edit"></mat-icon>
          </button>

          <button
            mat-icon-button
            class="icon-btn"
            aria-label="Delete drawing"
            title="Delete drawing"
            (click)="$event.preventDefault(); $event.stopPropagation(); onDelete(d.id)"
          >
            <fa-icon [icon]="faTrash"></fa-icon>
          </button>
        </div>
      </div>
    </a>
  </div>

  <h3 class="state" *ngIf="!drawings.length && !(loading$ | async)">
    {{ searchText ? 'No matches.' : 'No drawings here yet.' }}
  </h3>

  <div *ngIf="loading$ | async">
    <h3 class="state">Loading drawings…</h3>
  </div>
</div>
